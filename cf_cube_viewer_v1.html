<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CF Method Cube Viewer v1 (3x3 & 2x2-like)</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/larspetrus/Roofpig/roofpig_and_three.min.js"></script>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 16px;
      background: #111;
      color: #f5f5f5;
    }
    h1, h2 {
      text-align: center;
    }
    .layout {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: center;
    }
    .panel {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 16px;
      max-width: 420px;
      flex: 1 1 360px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.4);
    }
    .roofpig {
      width: 260px;
      height: 320px;
      margin: 0 auto 12px auto;
    }
    textarea {
      width: 100%;
      min-height: 60px;
      background: #111;
      color: #f5f5f5;
      border-radius: 8px;
      border: 1px solid #333;
      padding: 8px;
      resize: vertical;
      font-family: monospace;
    }
    button {
      margin: 4px;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #2a2a2a;
      color: #f5f5f5;
      cursor: pointer;
      font-size: 12px;
    }
    button:hover {
      background: #3a3a3a;
    }
    .btn-row {
      margin-top: 4px;
    }
    .small-note {
      font-size: 12px;
      color: #bbb;
      margin-top: 4px;
    }
    .face-group-title {
      margin-top: 8px;
      font-weight: bold;
      font-size: 13px;
    }
    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    .label-inline {
      font-size: 13px;
      min-width: 80px;
    }
  </style>
</head>
<body>
  <h1>CF Method Cube Viewer v1</h1>
  <p style="text-align:center;font-size:13px;">
    3x3と「コーナーのみ表示(2x2相当)」のRoofpigビューアです。<br>
    配色: U=白, D=黄, F=緑, B=青, R=赤, L=オレンジ
  </p>

  <div class="layout">
    <!-- 3x3 Viewer Panel -->
    <div class="panel">
      <h2>3x3 Viewer</h2>
      <div id="cube3" class="roofpig"
           data-config="alg=|colors=F:g B:b U:w D:y R:r L:o|hover=3|speed=700">
      </div>

      <div class="flex-row">
        <span class="label-inline">スクランブル:</span>
        <button onclick="applyScramble()">Apply Scramble</button>
        <button onclick="resetCube()">Reset</button>
      </div>
      <textarea id="scrambleInput" placeholder="例: R U R' U' F2 D' L2 ..."></textarea>
      <div class="small-note">
        ※ Scrambleは現在、alg=として適用されます（Roofpigの再生UIで1手ずつ確認できます）。
      </div>

      <div class="face-group-title">面回転プリセット（手順欄に追記）</div>
      <div class="btn-row">
        <button onclick="appendMove('U')">U</button>
        <button onclick="appendMove("U'")">U'</button>
        <button onclick="appendMove('U2')">U2</button>
        <button onclick="appendMove('R')">R</button>
        <button onclick="appendMove("R'")">R'</button>
        <button onclick="appendMove('R2')">R2</button>
        <button onclick="appendMove('L')">L</button>
        <button onclick="appendMove("L'")">L'</button>
        <button onclick="appendMove('L2')">L2</button>
      </div>
      <div class="btn-row">
        <button onclick="appendMove('F')">F</button>
        <button onclick="appendMove("F'")">F'</button>
        <button onclick="appendMove('F2')">F2</button>
        <button onclick="appendMove('B')">B</button>
        <button onclick="appendMove("B'")">B'</button>
        <button onclick="appendMove('B2')">B2</button>
        <button onclick="appendMove('D')">D</button>
        <button onclick="appendMove("D'")">D'</button>
        <button onclick="appendMove('D2')">D2</button>
      </div>

      <div class="face-group-title">手順（解法・検証用）</div>
      <textarea id="algInput" placeholder="ここに検証したい手順を入力（例: R U R' U'）"></textarea>
      <div class="btn-row">
        <button onclick="applyAlg()">この手順を適用（alg=）</button>
        <button onclick="clearAlg()">手順クリア</button>
      </div>
      <div class="small-note">
        ※ Roofpig標準の再生UI（再生ボタン・スライダー）で1手ずつ進めたり戻したりできます。<br>
        ※ 将来的に、ここから自動ソルバー連携やCO/CP/EO/EPの計算も追加可能です。
      </div>
    </div>

    <!-- 2x2-like (corner-only) Viewer Panel -->
    <div class="panel">
      <h2>Corner-only Viewer (2x2相当)</h2>
      <div id="cube2" class="roofpig"
           data-config="alg=|colors=F:g B:b U:w D:y R:r L:o|pieces=corner|hover=3|speed=700">
      </div>
      <p class="small-note">
        エッジを無視してコーナーのみを表示しています。<br>
        2x2のOCLL/OCPLLや、8コーナーCF法の研究に使えます。
      </p>

      <div class="face-group-title">同じScrambleを適用</div>
      <div class="btn-row">
        <button onclick="applyScrambleToCorner()">Scrambleを適用（コーナーのみ）</button>
        <button onclick="resetCorner()">Reset (コーナー)</button>
      </div>

      <div class="face-group-title">このビューのための手順</div>
      <textarea id="algInputCorner" placeholder="2x2/8コーナー用の手順（R U R' U' など）"></textarea>
      <div class="btn-row">
        <button onclick="applyAlgCorner()">この手順を適用（corner alg）</button>
        <button onclick="clearAlgCorner()">手順クリア</button>
      </div>

      <div class="small-note">
        ※ ここもRoofpig標準UIで1手ずつ確認可能です。<br>
        ※ 実質「2x2 CF法ビューア」として使えます（エッジは無視してください）。
      </div>
    </div>
  </div>

  <script>
    function buildConfig(alg, extra) {
      alg = alg || "";
      alg = alg.trim();
      var base = "alg=" + alg + "|colors=F:g B:b U:w D:y R:r L:o";
      if (extra) base += "|" + extra;
      return base;
    }

    function applyConfigTo(divId, config) {
      var el = document.getElementById(divId);
      if (!el) return;
      el.setAttribute("data-config", config);
      var parent = el.parentNode;
      var clone = el.cloneNode(false);
      parent.replaceChild(clone, el);
      if (window.Roofpig && window.Roofpig.parseAll) {
        window.Roofpig.parseAll();
      }
    }

    function applyScramble() {
      var scr = document.getElementById("scrambleInput").value || "";
      var cfg = buildConfig(scr, "hover=3|speed=700");
      applyConfigTo("cube3", cfg);
    }

    function resetCube() {
      var cfg = buildConfig("", "hover=3|speed=700");
      applyConfigTo("cube3", cfg);
    }

    function appendMove(m) {
      var ta = document.getElementById("algInput");
      var cur = ta.value.trim();
      if (cur.length > 0) {
        ta.value = cur + " " + m;
      } else {
        ta.value = m;
      }
    }

    function applyAlg() {
      var alg = document.getElementById("algInput").value || "";
      var cfg = buildConfig(alg, "hover=3|speed=700");
      applyConfigTo("cube3", cfg);
    }

    function clearAlg() {
      document.getElementById("algInput").value = "";
    }

    function applyScrambleToCorner() {
      var scr = document.getElementById("scrambleInput").value || "";
      var cfg = buildConfig(scr, "pieces=corner|hover=3|speed=700");
      applyConfigTo("cube2", cfg);
    }

    function resetCorner() {
      var cfg = buildConfig("", "pieces=corner|hover=3|speed=700");
      applyConfigTo("cube2", cfg);
    }

    function applyAlgCorner() {
      var alg = document.getElementById("algInputCorner").value || "";
      var cfg = buildConfig(alg, "pieces=corner|hover=3|speed=700");
      applyConfigTo("cube2", cfg);
    }

    function clearAlgCorner() {
      document.getElementById("algInputCorner").value = "";
    }
  </script>
</body>
</html>
