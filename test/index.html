<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAZCUBE Lab - v5.16 UI Layout Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>
    <style>
        /* ã‚­ãƒ¥ãƒ¼ãƒ–ã®å¤§ãã•ã‚’åˆ¶é™ã—ã¦ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’æŠ¼ã—å‡ºã•ãªã„ã‚ˆã†ã«ã™ã‚‹ */
        twisty-player { 
            width: 100%; 
            height: 100%;
            max-height: 45vh; /* ç”»é¢é«˜ã•ã®45%ã¾ã§ã«åˆ¶é™ */
        }
        .main-grid { 
            display: grid; 
            grid-template-columns: 1fr 400px; 
            gap: 20px; 
            max-height: 90vh;
        }
        @media (max-width: 900px) { 
            .main-grid { grid-template-columns: 1fr; max-height: none; } 
            twisty-player { max-height: 400px; }
        }
        
        .move-btn { @apply bg-slate-700 active:bg-indigo-600 text-white py-2 rounded text-[10px] font-mono font-bold border border-slate-600 transition-all hover:bg-slate-600; }
        
        /* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆå¼·åˆ¶è¡¨ç¤º */
        .color-dot {
            width: 32px !important; height: 32px !important;
            display: inline-block !important; border-radius: 50%;
            border: 2px solid #475569; cursor: pointer; transition: all 0.2s; position: relative;
        }
        .color-dot.active { border-color: white !important; box-shadow: 0 0 10px rgba(255,255,255,0.5); transform: scale(1.1); }
        .color-dot.active::after { content: 'âœ“'; position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-weight: 900; color: rgba(0,0,0,0.5); }

        .template-btn { @apply flex-1 py-2 text-[10px] font-black rounded-lg border-2 transition-all flex items-center justify-center gap-1 uppercase bg-slate-800 border-slate-700 text-slate-400; }
        .template-btn.active[data-type="clear"] { @apply bg-slate-100 border-slate-400 text-slate-900; }
        .template-btn.active[data-type="corners"] { @apply bg-orange-600 border-orange-400 text-white; }
        
        /* å³ãƒ‘ãƒãƒ«ãŒé•·ã„å ´åˆã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«ã™ã‚‹ */
        .scroll-panel { overflow-y: auto; max-height: 85vh; padding-right: 10px; }
    </style>
</head>
<body class="min-h-screen bg-slate-900 text-slate-100 p-4 font-sans overflow-hidden">

    <div class="max-w-[1300px] mx-auto">
        <header class="mb-4 flex justify-between items-center border-b border-slate-700 pb-2">
            <h2 class="text-xl font-black text-emerald-400 italic italic">KAZCUBE Lab</h2>
            <div class="flex gap-2">
                <button id="btn-lang-ja" class="px-2 py-1 text-[9px] font-bold rounded bg-slate-800 border border-slate-700 hover:bg-slate-700">JP</button>
                <button id="btn-lang-en" class="px-2 py-1 text-[9px] font-bold rounded bg-slate-800 border border-slate-700 hover:bg-slate-700">EN</button>
            </div>
        </header>

        <div class="main-grid">
            <div class="flex flex-col gap-4">
                <div class="bg-black rounded-3xl border-4 border-slate-700 overflow-hidden shadow-2xl flex-grow flex items-center justify-center" style="min-height: 300px;">
                    <twisty-player id="main-cube" puzzle="3x3x3" background="none" control-panel="none"></twisty-player>
                </div>
                <div class="bg-slate-800/50 p-4 rounded-2xl border border-slate-700 shadow-xl space-y-3">
                    <input type="range" id="move-slider" min="0" max="0" value="0" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                    <div class="flex justify-between items-center font-mono">
                        <div class="flex flex-col"><span id="lbl-step" class="text-slate-500 text-[9px] uppercase font-bold">STEP</span><span id="step-counter" class="text-emerald-500 text-xl font-bold">0</span></div>
                        <div id="move-indicator" class="text-lg font-black bg-slate-900 px-4 py-1 rounded-xl text-emerald-400 border border-slate-700 italic">---</div>
                    </div>
                </div>
            </div>

            <div class="scroll-panel space-y-5">
                <div class="flex bg-slate-950 p-1 rounded-xl border border-slate-700">
                    <button id="mode-rotate" class="flex-1 py-2 rounded-lg text-xs font-black transition-all bg-emerald-600 text-white">ROTATE</button>
                    <button id="mode-paint" class="flex-1 py-2 rounded-lg text-xs font-black text-slate-500 hover:text-white">PAINT</button>
                </div>

                <div id="paint-panel" class="hidden space-y-4 p-4 bg-slate-900 rounded-xl border-2 border-orange-500/20">
                    <div class="space-y-2">
                        <label id="lbl-display" class="text-[9px] font-black text-slate-500 uppercase">Display Settings</label>
                        <div class="flex gap-2">
                            <button class="template-btn" data-type="clear" id="btn-all-gray">â¬œ ALL GRAY</button>
                            <button class="template-btn" data-type="corners" id="btn-corners">ğŸ§© CORNERS</button>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label id="lbl-target" class="text-[9px] font-black text-slate-500 uppercase">Target Color</label>
                        <div class="flex flex-wrap justify-center gap-3 p-3 bg-black/40 rounded-xl">
                            <div class="color-dot" data-color="white" style="background-color: #fff;"></div>
                            <div class="color-dot" data-color="yellow" style="background-color: #facc15;"></div>
                            <div class="color-dot" data-color="red" style="background-color: #ef4444;"></div>
                            <div class="color-dot" data-color="orange" style="background-color: #f97316;"></div>
                            <div class="color-dot" data-color="blue" style="background-color: #3b82f6;"></div>
                            <div class="color-dot" data-color="green" style="background-color: #22c55e;"></div>
                        </div>
                    </div>
                </div>

                <div class="space-y-2">
                    <textarea id="command-box" class="w-full h-20 bg-black/60 text-emerald-400 p-3 rounded-xl font-mono text-[11px] border border-slate-700 outline-none resize-none" placeholder="Algorithm..."></textarea>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="btn-scramble" class="py-2 bg-indigo-600 rounded-lg font-bold text-[10px] uppercase shadow-lg">SCRAMBLE</button>
                        <button id="btn-reset" class="py-2 bg-slate-700 text-slate-300 rounded-lg font-bold text-[10px] uppercase border border-slate-600">RESET</button>
                    </div>
                </div>

                <div class="bg-slate-800/40 rounded-xl border border-slate-700 p-3">
                    <label class="text-[9px] font-black text-slate-500 uppercase mb-2 block">Basic Moves</label>
                    <div id="grid-basic" class="grid grid-cols-4 gap-1.5"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        const i18n = {
            ja: { display: "è¡¨ç¤ºè¨­å®š", allGray: "â¬œ å…¨ã‚°ãƒ¬ãƒ¼", corners: "ğŸ§© ã‚³ãƒ¼ãƒŠãƒ¼", target: "ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè‰²", reset: "ãƒªã‚»ãƒƒãƒˆ", placeholder: "æ‰‹é †ã‚’è²¼ã‚Šä»˜ã‘..." },
            en: { display: "DISPLAY SETTINGS", allGray: "â¬œ ALL GRAY", corners: "ğŸ§© CORNERS", target: "TARGET COLOR", reset: "RESET ALL", placeholder: "Paste algorithm..." }
        };

        const player = document.getElementById('main-cube');
        const paintPanel = document.getElementById('paint-panel');
        const slider = document.getElementById('move-slider');
        let moves = [];

        const render = (step) => {
            player.alg = moves.slice(0, step).join(" ");
            slider.value = step;
            document.getElementById('step-counter').textContent = step;
            document.getElementById('move-indicator').textContent = step > 0 ? moves[step-1] : "---";
        };

        // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
        document.getElementById('mode-rotate').onclick = () => {
            paintPanel.style.display = 'none';
            player.experimentalStickeringMaskOrbits = "";
            document.getElementById('mode-rotate').className = "flex-1 py-2 rounded-lg text-xs font-black bg-emerald-600 text-white";
            document.getElementById('mode-paint').className = "flex-1 py-2 rounded-lg text-xs font-black text-slate-500";
        };

        document.getElementById('mode-paint').onclick = () => {
            paintPanel.style.display = 'block';
            player.experimentalStickeringMaskOrbits = "EDGES:IIIIIIIIIIII,CORNERS:IIIIIIII,CENTERS:IIIIII";
            document.getElementById('mode-paint').className = "flex-1 py-2 rounded-lg text-xs font-black bg-orange-600 text-white shadow-lg";
            document.getElementById('mode-rotate').className = "flex-1 py-2 rounded-lg text-xs font-black text-slate-500";
        };

        // å›è»¢ãƒœã‚¿ãƒ³ç”Ÿæˆ (U, U', D, D'... è¨ˆ12å€‹ã‚’ç¢ºå®Ÿã«ç”Ÿæˆ)
        const grid = document.getElementById('grid-basic');
        ['U','D','L','R','F','B'].forEach(f => {
            [f, f+"'"].forEach(m => {
                const b = document.createElement('button');
                b.className = "move-btn";
                b.textContent = m;
                b.onclick = () => {
                    const step = parseInt(slider.value);
                    if (step < moves.length) moves = moves.slice(0, step);
                    moves.push(m);
                    slider.max = moves.length;
                    render(moves.length);
                };
                grid.appendChild(b);
            });
        });

        // ãƒ‘ãƒ¬ãƒƒãƒˆç­‰ã®ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
        document.querySelectorAll('.template-btn').forEach(btn => {
            btn.onclick = (e) => {
                player.experimentalStickeringMaskOrbits = (e.currentTarget.dataset.type === 'clear') ? "EDGES:IIIIIIIIIIII,CORNERS:IIIIIIII,CENTERS:IIIIII" : "EDGES:IIIIIIIIIIII,CORNERS:--------,CENTERS:------";
                document.querySelectorAll('.template-btn').forEach(b => b.classList.remove('active'));
                e.currentTarget.classList.add('active');
                const t = player.alg; player.alg = ""; setTimeout(()=>player.alg=t, 1);
            };
        });
        document.querySelectorAll('.color-dot').forEach(dot => {
            dot.onclick = (e) => {
                document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
                e.currentTarget.classList.add('active');
            };
        });

        slider.oninput = () => render(parseInt(slider.value));
        document.getElementById('btn-reset').onclick = () => { moves = []; slider.max = 0; render(0); };
        document.getElementById('btn-scramble').onclick = () => {
            const raw = document.getElementById('command-box').value;
            if(raw) { moves = raw.trim().split(/\s+/); slider.max = moves.length; render(moves.length); }
        };

        window.setLang = (lang) => {
            const t = i18n[lang];
            document.getElementById('lbl-display').textContent = t.display;
            document.getElementById('btn-all-gray').textContent = t.allGray;
            document.getElementById('btn-corners').textContent = t.corners;
            document.getElementById('lbl-target').textContent = t.target;
            document.getElementById('btn-reset').textContent = t.reset;
            document.getElementById('command-box').placeholder = t.placeholder;
        };
        document.getElementById('btn-lang-ja').onclick = () => setLang('ja');
        document.getElementById('btn-lang-en').onclick = () => setLang('en');
    </script>
</body>
</html>