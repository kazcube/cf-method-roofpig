<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAZCUBE Lab - Ver 5.3 Mobile Optimized</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>
    <style>
        twisty-player { touch-action: none; width: 100%; height: 100%; }
        .move-btn { @apply bg-slate-700 active:bg-indigo-600 py-2 rounded text-[11px] font-mono font-bold border border-slate-600 shadow-sm; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .accordion-content.open { max-height: 500px; transition: max-height 0.5s ease-in; }
        .color-dot { width: 22px; height: 22px; border-radius: 50%; border: 2px solid #334155; }
        .color-dot.active { border-color: white; box-shadow: 0 0 8px #fff; }
    </style>
</head>
<body class="min-h-screen bg-slate-900 text-slate-100 font-sans">
    <div class="max-w-md mx-auto bg-slate-800 min-h-screen shadow-2xl flex flex-col">
        <div class="sticky top-0 z-20 bg-slate-800 p-4 border-b border-slate-700 shadow-lg">
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-lg font-black text-emerald-400 italic">KAZCUBE Lab <span class="text-[9px] font-mono text-slate-500 not-italic">v5.3</span></h2>
                <div id="mode-badge" class="text-[9px] font-mono bg-blue-900 px-2 py-1 rounded-full border border-blue-500/30 uppercase">Rotate</div>
            </div>
            
            <div class="bg-black rounded-2xl aspect-square border-2 border-slate-700 overflow-hidden mb-4 shadow-inner">
                <twisty-player id="main-cube" puzzle="3x3x3" background="none" control-panel="none"></twisty-player>
            </div>

            <div class="space-y-2">
                <input type="range" id="move-slider" min="0" max="0" value="0" step="1" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none accent-emerald-500">
                <div class="flex justify-between items-center text-[10px] font-mono text-slate-400">
                    <span>STEP: <b id="step-counter" class="text-emerald-500 text-sm">0</b></span>
                    <span id="move-indicator" class="bg-slate-900 px-3 py-0.5 rounded border border-slate-700">---</span>
                </div>
            </div>
        </div>

        <div class="p-4 space-y-4 flex-grow overflow-y-auto">
            
            <div class="grid grid-cols-2 gap-2 p-1 bg-slate-900 rounded-xl border border-slate-700">
                <button id="mode-rotate" class="py-2 rounded-lg text-xs font-bold bg-emerald-600 text-white">ROTATE</button>
                <button id="mode-paint" class="py-2 rounded-lg text-xs font-bold text-slate-500">PAINT</button>
            </div>

            <div id="paint-panel" class="hidden space-y-3 p-3 bg-slate-900 rounded-xl border border-orange-900/30">
                <div class="flex gap-1">
                    <button class="template-btn flex-1 py-1.5 text-[9px] font-bold bg-slate-800 rounded active:bg-orange-600" data-type="clear">ALL CLEAR</button>
                    <button class="template-btn flex-1 py-1.5 text-[9px] font-bold bg-slate-800 rounded" data-type="corners">CORNERS</button>
                </div>
                <div class="flex justify-center gap-2 py-1">
                    <div class="color-dot active bg-white" data-color="white"></div>
                    <div class="color-dot bg-yellow-400" data-color="yellow"></div>
                    <div class="color-dot bg-red-500" data-color="red"></div>
                    <div class="color-dot bg-blue-500" data-color="blue"></div>
                    <div class="color-dot bg-slate-500" data-color="gray"></div>
                </div>
            </div>

            <div class="space-y-2">
                <textarea id="command-box" class="w-full h-14 bg-black/40 text-emerald-400 p-2 rounded-lg font-mono text-[11px] border border-slate-700 outline-none resize-none" placeholder="Paste moves here..."></textarea>
                <div class="grid grid-cols-2 gap-2 text-[10px] font-bold">
                    <button id="btn-scramble" class="py-2 bg-indigo-600 rounded-lg uppercase">Scramble</button>
                    <button id="btn-reset" class="py-2 bg-slate-700 rounded-lg uppercase text-red-400">Reset All</button>
                </div>
            </div>

            <div class="space-y-2 border-t border-slate-700 pt-2">
                <button class="accordion-toggle w-full flex justify-between items-center py-2 px-1 text-xs font-black text-slate-400 uppercase tracking-widest" data-target="basic-moves">
                    <span>Basic Moves (U R L...)</span>
                    <span class="icon">▼</span>
                </button>
                <div id="basic-moves" class="accordion-content">
                    <div class="grid grid-cols-6 gap-1.5 pb-4" id="grid-basic"></div>
                </div>

                <button class="accordion-toggle w-full flex justify-between items-center py-2 px-1 text-xs font-black text-slate-400 uppercase tracking-widest border-t border-slate-800" data-target="wide-moves">
                    <span>Wide & Rotation (u r x...)</span>
                    <span class="icon">▼</span>
                </button>
                <div id="wide-moves" class="accordion-content">
                    <div class="grid grid-cols-6 gap-1.5 pb-4" id="grid-wide"></div>
                </div>
            </div>
            
            <p class="text-[9px] text-center text-slate-600 py-4 uppercase tracking-[0.3em]">© 2026 KAZCUBE LAB</p>
        </div>
    </div>

    <script type="module">
        const player = document.getElementById('main-cube');
        const cmdBox = document.getElementById('command-box');
        const slider = document.getElementById('move-slider');
        
        let moves = [];
        let currentMode = 'rotate';

        // --- Setup Buttons ---
        const setupGrid = (id, list) => {
            const el = document.getElementById(id);
            list.forEach(m => {
                const btn = document.createElement('button');
                btn.className = "move-btn";
                btn.textContent = m;
                btn.onclick = () => handleMove(m);
                el.appendChild(btn);
            });
        };

        setupGrid('grid-basic', ['U','U\'','D','D\'','L','L\'','R','R\'','F','F\'','B','B\'']);
        setupGrid('grid-wide', ['u','u\'','d','d\'','l','l\'','r','r\'','M','M\'','x','y']);

        // --- Accordion Logic ---
        document.querySelectorAll('.accordion-toggle').forEach(btn => {
            btn.onclick = () => {
                const target = document.getElementById(btn.dataset.target);
                const isOpen = target.classList.contains('open');
                // Close all
                document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('open'));
                document.querySelectorAll('.icon').forEach(i => i.textContent = '▼');
                // Toggle target
                if (!isOpen) {
                    target.classList.add('open');
                    btn.querySelector('.icon').textContent = '▲';
                }
            };
        });

        // --- Cube Logic ---
        const render = (step) => {
            player.alg = moves.slice(0, step).join(" ");
            slider.value = step;
            document.getElementById('step-counter').textContent = step;
            document.getElementById('move-indicator').textContent = step > 0 ? moves[step-1] : "---";
            if (currentMode === 'rotate') cmdBox.value = moves.join(" ");
        };

        const handleMove = (m) => {
            const step = parseInt(slider.value);
            if (step < moves.length) moves = moves.slice(0, step);
            moves.push(m);
            slider.max = moves.length;
            render(moves.length);
        };

        slider.oninput = () => render(parseInt(slider.value));

        // --- Mode & Reset ---
        document.getElementById('mode-rotate').onclick = () => {
            currentMode = 'rotate';
            document.getElementById('paint-panel').classList.add('hidden');
            document.getElementById('mode-rotate').classList.add('bg-emerald-600');
            document.getElementById('mode-paint').classList.remove('bg-orange-600');
        };
        document.getElementById('mode-paint').onclick = () => {
            currentMode = 'paint';
            document.getElementById('paint-panel').classList.remove('hidden');
            document.getElementById('mode-paint').classList.add('bg-orange-600');
            document.getElementById('mode-rotate').classList.remove('bg-emerald-600');
            player.experimentalStickeringMaskOrbits = "EDGES:------------,CORNERS:--------,CENTERS:------";
        };

        document.getElementById('btn-reset').onclick = () => {
            moves = []; slider.max = 0; cmdBox.value = ""; player.alg = "";
            player.experimentalStickeringMaskOrbits = "";
            render(0);
        };

        document.getElementById('btn-scramble').onclick = () => {
            if(cmdBox.value) moves = cmdBox.value.split(/\s+/);
            else moves = Array.from({length:20}, () => ['U','D','L','R','F','B'][Math.floor(Math.random()*6)] + (Math.random() > 0.5 ? "'" : ""));
            slider.max = moves.length;
            render(moves.length);
        };
    </script>
</body>
</html>