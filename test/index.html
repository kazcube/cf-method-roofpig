<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAZCUBE Lab - Ver 5.4 Responsive & Full Moves</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>
    <style>
        twisty-player { touch-action: none; width: 100%; height: 100%; }
        .move-btn { @apply bg-slate-700 active:bg-indigo-600 text-white py-2 rounded text-[10px] font-mono font-bold border border-slate-600 shadow-sm transition-colors; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .accordion-content.open { max-height: 1000px; transition: max-height 0.5s ease-in; }
        .color-dot { width: 22px; height: 22px; border-radius: 50%; border: 2px solid #334155; cursor: pointer; }
        .color-dot.active { border-color: white; box-shadow: 0 0 8px #fff; }
    </style>
</head>
<body class="min-h-screen bg-slate-900 text-slate-100 font-sans p-2 sm:p-6">
    <div class="max-w-6xl mx-auto bg-slate-800 rounded-3xl border border-slate-700 shadow-2xl overflow-hidden">
        
        <header class="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800/50">
            <div class="flex items-baseline gap-2">
                <h2 class="text-xl font-black text-emerald-400 italic tracking-tighter">KAZCUBE Lab</h2>
                <span class="text-[10px] font-mono text-slate-500 uppercase">v5.4 Responsive</span>
            </div>
            <div id="mode-badge" class="text-[9px] font-mono bg-blue-900 text-blue-200 px-3 py-1 rounded-full border border-blue-500/30 uppercase tracking-widest">Rotate Mode</div>
        </header>

        <div class="grid lg:grid-cols-2 gap-0 lg:gap-6 p-4 lg:p-8">
            
            <div class="lg:sticky lg:top-8 self-start space-y-4">
                <div class="bg-black rounded-3xl aspect-square border-4 border-slate-700 overflow-hidden shadow-2xl relative">
                    <twisty-player id="main-cube" puzzle="3x3x3" background="none" control-panel="none"></twisty-player>
                </div>

                <div class="bg-slate-900 p-4 rounded-2xl border border-slate-700 space-y-3 shadow-inner">
                    <div class="flex justify-between items-center">
                        <div class="text-[10px] font-mono text-slate-400 uppercase tracking-widest">Progress Control</div>
                        <div id="move-indicator" class="text-sm font-bold bg-slate-800 px-4 py-1 rounded text-emerald-400 border border-slate-700">---</div>
                    </div>
                    <input type="range" id="move-slider" min="0" max="0" value="0" step="1" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                    <div class="flex justify-between text-[10px] font-mono text-slate-500">
                        <span>START</span>
                        <span>STEP: <b id="step-counter" class="text-emerald-500">0</b></span>
                        <span>END</span>
                    </div>
                </div>
            </div>

            <div class="space-y-6 mt-6 lg:mt-0">
                
                <div class="flex bg-slate-950 p-1 rounded-2xl border border-slate-700">
                    <button id="mode-rotate" class="flex-1 py-3 rounded-xl text-xs font-black transition-all bg-emerald-600 text-white shadow-lg">ROTATE</button>
                    <button id="mode-paint" class="flex-1 py-3 rounded-xl text-xs font-black transition-all text-slate-500">PAINT (ANALYSIS)</button>
                </div>

                <div id="paint-panel" class="hidden space-y-4 p-4 bg-slate-900 rounded-2xl border border-orange-500/20 animate-in fade-in duration-300">
                    <div class="flex gap-2">
                        <button class="template-btn flex-1 py-2 text-[10px] font-bold bg-slate-800 border border-slate-700 rounded-lg" data-type="clear">ALL CLEAR</button>
                        <button class="template-btn flex-1 py-2 text-[10px] font-bold bg-slate-800 border border-slate-700 rounded-lg" data-type="corners">CORNERS</button>
                    </div>
                    <div class="flex justify-center gap-3 py-2 bg-black/30 rounded-xl">
                        <div class="color-dot active bg-white" data-color="white"></div>
                        <div class="color-dot bg-yellow-400" data-color="yellow"></div>
                        <div class="color-dot bg-red-500" data-color="red"></div>
                        <div class="color-dot bg-orange-500" data-color="orange"></div>
                        <div class="color-dot bg-blue-500" data-color="blue"></div>
                        <div class="color-dot bg-green-500" data-color="green"></div>
                        <div class="color-dot bg-slate-500" data-color="gray"></div>
                    </div>
                </div>

                <div class="space-y-2">
                    <textarea id="command-box" class="w-full h-20 bg-black/40 text-emerald-400 p-4 rounded-xl font-mono text-xs border border-slate-700 outline-none focus:border-indigo-500 resize-none transition-all" placeholder="粘贴或输入公式..."></textarea>
                    <div class="grid grid-cols-2 gap-3">
                        <button id="btn-scramble" class="py-3 bg-indigo-600 hover:bg-indigo-500 rounded-xl font-bold text-xs uppercase tracking-widest shadow-lg active:scale-95 transition-all">Scramble</button>
                        <button id="btn-reset" class="py-3 bg-slate-700 hover:bg-red-900/40 text-slate-300 hover:text-red-400 rounded-xl font-bold text-xs uppercase tracking-widest border border-slate-600 transition-all">Reset All</button>
                    </div>
                </div>

                <div class="space-y-3">
                    <div class="border border-slate-700 rounded-2xl overflow-hidden">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 bg-slate-900/50 hover:bg-slate-900 text-[10px] font-black uppercase tracking-widest" data-target="basic-moves">
                            <span>Basic Layer (U R L D F B)</span>
                            <span class="icon">▼</span>
                        </button>
                        <div id="basic-moves" class="accordion-content open">
                            <div class="grid grid-cols-3 sm:grid-cols-6 gap-2 p-4 bg-slate-900/20" id="grid-basic"></div>
                        </div>
                    </div>

                    <div class="border border-slate-700 rounded-2xl overflow-hidden">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 bg-slate-900/50 hover:bg-slate-900 text-[10px] font-black uppercase tracking-widest" data-target="wide-moves">
                            <span>Wide & Middle (u r M E S)</span>
                            <span class="icon">▼</span>
                        </button>
                        <div id="wide-moves" class="accordion-content">
                            <div class="grid grid-cols-3 sm:grid-cols-6 gap-2 p-4 bg-slate-900/20" id="grid-wide"></div>
                        </div>
                    </div>

                    <div class="border border-slate-700 rounded-2xl overflow-hidden">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 bg-slate-900/50 hover:bg-slate-900 text-[10px] font-black uppercase tracking-widest" data-target="rot-moves">
                            <span>Cube Rotation (x y z)</span>
                            <span class="icon">▼</span>
                        </button>
                        <div id="rot-moves" class="accordion-content">
                            <div class="grid grid-cols-3 sm:grid-cols-6 gap-2 p-4 bg-slate-900/20" id="grid-rot"></div>
                        </div>
                    </div>
                </div>

                <footer class="text-center py-6 border-t border-slate-700">
                    <p class="text-[9px] text-slate-600 uppercase tracking-[0.4em] font-bold">© 2026 KAZCUBE ANALYSIS LAB</p>
                </footer>
            </div>
        </div>
    </div>

    <script type="module">
        const player = document.getElementById('main-cube');
        const cmdBox = document.getElementById('command-box');
        const slider = document.getElementById('move-slider');
        const stepCounter = document.getElementById('step-counter');
        const moveIndicator = document.getElementById('move-indicator');
        
        let moves = [];
        let currentMode = 'rotate';

        // --- Setup Move Buttons (Including '2' moves) ---
        const createBtns = (targetId, faces) => {
            const grid = document.getElementById(targetId);
            faces.forEach(f => {
                [f, f+"'", f+"2"].forEach(m => {
                    const btn = document.createElement('button');
                    btn.className = "move-btn";
                    btn.textContent = m;
                    btn.onclick = () => handleMove(m);
                    grid.appendChild(btn);
                });
            });
        };

        createBtns('grid-basic', ['U','D','L','R','F','B']);
        createBtns('grid-wide', ['u','d','l','r','f','b','M','E','S']);
        createBtns('grid-rot', ['x','y','z']);

        // --- Accordion Logic ---
        document.querySelectorAll('.accordion-toggle').forEach(btn => {
            btn.onclick = () => {
                const target = document.getElementById(btn.dataset.target);
                const isOpen = target.classList.contains('open');
                target.classList.toggle('open', !isOpen);
                btn.querySelector('.icon').textContent = isOpen ? '▼' : '▲';
            };
        });

        // --- Cube Engine ---
        const render = (step) => {
            player.alg = moves.slice(0, step).join(" ");
            slider.value = step;
            stepCounter.textContent = step;
            moveIndicator.textContent = step > 0 ? moves[step-1] : "---";
            if (currentMode === 'rotate') cmdBox.value = moves.join(" ");
        };

        const handleMove = (m) => {
            const step = parseInt(slider.value);
            if (step < moves.length) moves = moves.slice(0, step);
            moves.push(m);
            slider.max = moves.length;
            render(moves.length);
        };

        slider.oninput = () => render(parseInt(slider.value));

        // --- Mode & Reset ---
        const setMode = (mode) => {
            currentMode = mode;
            const isPaint = mode === 'paint';
            document.getElementById('paint-panel').classList.toggle('hidden', !isPaint);
            document.getElementById('mode-rotate').classList.toggle('bg-emerald-600', !isPaint);
            document.getElementById('mode-paint').classList.toggle('bg-orange-600', isPaint);
            if (isPaint) player.experimentalStickeringMaskOrbits = "EDGES:------------,CORNERS:--------,CENTERS:------";
        };

        document.getElementById('mode-rotate').onclick = () => setMode('rotate');
        document.getElementById('mode-paint').onclick = () => setMode('paint');

        document.getElementById('btn-reset').onclick = () => {
            moves = []; slider.max = 0; cmdBox.value = ""; player.alg = "";
            player.experimentalStickeringMaskOrbits = "";
            render(0); setMode('rotate');
        };

        document.getElementById('btn-scramble').onclick = () => {
            if(cmdBox.value) moves = cmdBox.value.split(/\s+/).filter(x => x.length > 0);
            else {
                const f = ['U','D','L','R','F','B'];
                moves = Array.from({length:20}, () => f[Math.floor(Math.random()*6)] + (Math.random() > 0.6 ? "2" : (Math.random() > 0.3 ? "'" : "")));
            }
            slider.max = moves.length;
            render(moves.length);
        };
    </script>
</body>
</html>