<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAZCUBE Lab - v5.26 Hard Reset</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>
    <style>
        .main-grid { display: flex; gap: 24px; align-items: start; justify-content: center; }
        .left-col { flex: 1; min-width: 300px; }
        .right-col { width: 380px; min-width: 380px; display: flex; flex-direction: column; gap: 16px; }
        .cube-container { width: 100%; height: 380px; background: #000; border-radius: 1.5rem; border: 4px solid #334155; overflow: hidden; }
        twisty-player { width: 100%; height: 100%; }

        /* „É¢„Éº„ÉâÂàáÊõø„Éú„Çø„É≥ */
        .mode-btn { flex: 1; padding: 10px 0; border-radius: 8px; font-weight: 900; font-size: 12px; transition: 0.2s; border: 2px solid transparent; }
        .btn-rotate-active { background-color: #10b981 !important; color: white !important; border-color: #34d399 !important; box-shadow: 0 0 15px rgba(16,185,129,0.4); }
        .btn-paint-active { background-color: #f97316 !important; color: white !important; border-color: #fb923c !important; box-shadow: 0 0 15px rgba(249,115,22,0.4); }
        .btn-inactive { background-color: #1e293b !important; color: #475569 !important; border-color: transparent !important; }

        /* ÂõûËª¢„Éú„Çø„É≥ */
        .move-btn { background-color: #334155; color: white; padding: 8px 0; border-radius: 6px; font-family: monospace; font-size: 11px; font-weight: bold; border: 1px solid #475569; }
        .move-btn:active { background-color: #6366f1; }
        
        /* „Çø„Éñ */
        .tab-btn { flex: 1; padding: 6px 0; font-size: 10px; font-weight: 900; border-radius: 6px; color: #94a3b8; }
        .tab-btn.active { background-color: #475569; color: white; }

        .color-dot { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #475569; cursor: pointer; transition: 0.2s; }
        .color-dot.active { border-color: white; transform: scale(1.1); box-shadow: 0 0 8px white; }

        @media (max-width: 850px) { .main-grid { flex-direction: column; } .right-col { width: 100%; } }
    </style>
</head>
<body class="min-h-screen bg-slate-900 text-slate-100 p-4">

    <div class="max-w-[1200px] mx-auto">
        <header class="mb-4 flex justify-between items-baseline border-b border-slate-700 pb-4">
            <div class="flex items-baseline gap-3">
                <h2 class="text-2xl font-black text-emerald-400 italic">KAZCUBE Lab</h2>
                <span class="text-[10px] font-mono text-slate-500 border border-slate-700 px-2 py-0.5 rounded bg-slate-800">v5.26 HardReset</span>
            </div>
        </header>

        <div class="main-grid">
            <div class="left-col space-y-4">
                <div class="cube-container shadow-2xl">
                    <twisty-player id="main-cube" puzzle="3x3x3" background="none" control-panel="none"></twisty-player>
                </div>
                <div class="bg-slate-800 p-4 rounded-2xl border border-slate-700 space-y-3">
                    <input type="range" id="move-slider" min="0" max="0" value="0" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                    <div class="flex justify-between items-center font-mono">
                        <div class="flex flex-col"><span class="text-slate-500 text-[9px] uppercase">Step</span><span id="step-counter" class="text-emerald-500 text-xl font-bold">0</span></div>
                        <div id="move-indicator" class="text-lg font-black bg-slate-900 px-4 py-1 rounded-xl text-emerald-400 border border-slate-700 italic">---</div>
                    </div>
                </div>
            </div>

            <div class="right-col">
                <div class="flex bg-slate-950 p-1 rounded-xl border border-slate-700 gap-1">
                    <button id="btn-mode-rotate" class="mode-btn btn-rotate-active" onclick="handleModeSwitch('rotate')">ROTATE</button>
                    <button id="btn-mode-paint" class="mode-btn btn-inactive" onclick="handleModeSwitch('paint')">PAINT</button>
                </div>

                <div id="panel-paint" class="hidden space-y-4 p-4 bg-slate-900 rounded-xl border-2 border-orange-500/20">
                    <div class="flex gap-2">
                        <button onclick="applyMask('all-gray')" class="flex-1 py-2 bg-slate-800 text-[10px] font-bold rounded border border-slate-700 hover:bg-slate-700">‚¨ú ALL GRAY</button>
                        <button onclick="applyMask('corners')" class="flex-1 py-2 bg-slate-800 text-[10px] font-bold rounded border border-slate-700 hover:bg-slate-700">üß© CORNERS</button>
                    </div>
                    <div class="flex justify-center gap-2 p-2 bg-black/40 rounded-lg">
                        <div class="color-dot active" style="background:#fff" onclick="pickColor(this)"></div>
                        <div class="color-dot" style="background:#facc15" onclick="pickColor(this)"></div>
                        <div class="color-dot" style="background:#ef4444" onclick="pickColor(this)"></div>
                        <div class="color-dot" style="background:#f97316" onclick="pickColor(this)"></div>
                        <div class="color-dot" style="background:#3b82f6" onclick="pickColor(this)"></div>
                        <div class="color-dot" style="background:#22c55e" onclick="pickColor(this)"></div>
                    </div>
                </div>

                <div class="space-y-2">
                    <textarea id="command-box" class="w-full h-20 bg-black text-emerald-400 p-3 rounded-xl font-mono text-xs border border-slate-700 outline-none" placeholder="Paste Algorithm here..."></textarea>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="loadAlg()" class="py-2.5 bg-indigo-600 rounded-lg font-bold text-[10px] text-white uppercase shadow-md active:scale-95">SCRAMBLE</button>
                        <button onclick="resetCube()" class="py-2.5 bg-slate-700 rounded-lg font-bold text-[10px] text-slate-300 uppercase active:scale-95">RESET</button>
                    </div>
                </div>

                <div class="bg-slate-800/40 rounded-xl border border-slate-700 p-3">
                    <div class="flex gap-1 mb-3 bg-black/30 p-1 rounded-lg">
                        <button id="tab-basic" onclick="setMoveTab('basic')" class="tab-btn active">BASIC</button>
                        <button id="tab-wide" onclick="setMoveTab('wide')" class="tab-btn">WIDE</button>
                        <button id="tab-slice" onclick="setMoveTab('slice')" class="tab-btn">SLICE</button>
                    </div>
                    <div id="move-grid" class="grid grid-cols-6 gap-1"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        const player = document.getElementById('main-cube');
        let movesArray = [];

        // „ÄêÊúÄÈáçË¶Å„ÄëÂº∑Âà∂„É™„Çª„ÉÉ„ÉàÈñ¢Êï∞Ôºö„Éû„Çπ„ÇØ„ÇíÊ∂à„Åó„ÄÅ„Ç≠„É•„Éº„Éñ„Çí„Ç´„É©„Éº„Å´Êàª„Åô
        window.handleModeSwitch = (mode) => {
            const rBtn = document.getElementById('btn-mode-rotate');
            const pBtn = document.getElementById('btn-mode-paint');
            const paintPanel = document.getElementById('panel-paint');

            if (mode === 'rotate') {
                // Âº∑Âà∂„Ç´„É©„ÉºÂæ©Â∏∞
                player.experimentalStickeringMaskOrbits = ""; 
                rBtn.className = "mode-btn btn-rotate-active";
                pBtn.className = "mode-btn btn-inactive";
                paintPanel.style.display = 'none';
            } else {
                // „Éû„Çπ„ÇØ„É¢„Éº„Éâ
                player.experimentalStickeringMaskOrbits = "EDGES:IIIIIIIIIIII,CORNERS:IIIIIIII,CENTERS:IIIIII";
                rBtn.className = "mode-btn btn-inactive";
                pBtn.className = "mode-btn btn-paint-active";
                paintPanel.style.display = 'block';
            }
            
            // ÊèèÁîª„Ç®„É≥„Ç∏„É≥„ÅÆ„É™„Çª„ÉÉ„Éà
            const currentAlg = player.alg;
            player.alg = ""; // ‰∏ÄÊó¶„ÇØ„É™„Ç¢
            setTimeout(() => { player.alg = currentAlg; }, 50); // ÂæÆÂ∞è„Å™ÈÅÖÂª∂„ÅßÂÜçÊèèÁîª„ÇíÂº∑Âà∂
        };

        window.applyMask = (type) => {
            player.experimentalStickeringMaskOrbits = (type === 'all-gray') 
                ? "EDGES:IIIIIIIIIIII,CORNERS:IIIIIIII,CENTERS:IIIIII" 
                : "EDGES:IIIIIIIIIIII,CORNERS:--------,CENTERS:------";
            const currentAlg = player.alg;
            player.alg = ""; 
            setTimeout(() => { player.alg = currentAlg; }, 30);
        };

        window.pickColor = (el) => {
            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
            el.classList.add('active');
        };

        // --- ÂõûËª¢„Éú„Çø„É≥ÁÆ°ÁêÜ ---
        const moveLib = {
            basic: ['U','D','L','R','F','B'],
            wide: ['u','d','l','r','f','b'],
            slice: ['M','E','S','x','y','z']
        };

        window.setMoveTab = (type) => {
            const grid = document.getElementById('move-grid');
            grid.innerHTML = '';
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + type).classList.add('active');

            moveLib[type].forEach(face => {
                [face, face+"'", face+"2"].forEach(m => {
                    const b = document.createElement('button');
                    b.className = "move-btn";
                    b.textContent = m;
                    b.onclick = () => {
                        const currentStep = parseInt(document.getElementById('move-slider').value);
                        if (currentStep < movesArray.length) movesArray = movesArray.slice(0, currentStep);
                        movesArray.push(m);
                        syncUI();
                    };
                    grid.appendChild(b);
                });
            });
        };

        const syncUI = () => {
            const slider = document.getElementById('move-slider');
            player.alg = movesArray.join(" ");
            slider.max = movesArray.length;
            slider.value = movesArray.length;
            document.getElementById('step-counter').textContent = movesArray.length;
            document.getElementById('move-indicator').textContent = movesArray.length > 0 ? movesArray[movesArray.length-1] : "---";
        };

        window.loadAlg = () => {
            const input = document.getElementById('command-box').value.trim();
            if (input) {
                movesArray = input.split(/\s+/);
                syncUI();
            }
        };

        window.resetCube = () => {
            movesArray = [];
            syncUI();
        };

        document.getElementById('move-slider').oninput = (e) => {
            const step = parseInt(e.target.value);
            player.alg = movesArray.slice(0, step).join(" ");
            document.getElementById('step-counter').textContent = step;
            document.getElementById('move-indicator').textContent = step > 0 ? movesArray[step-1] : "---";
        };

        // ÂàùÊúü„É≠„Éº„Éâ
        setMoveTab('basic');
    </script>
</body>
</html>