<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAZCUBE Lab - v5.24 Sync & Reset</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>
    <style>
        .main-grid { display: flex; gap: 24px; align-items: start; justify-content: center; }
        .left-col { flex: 1; min-width: 300px; }
        .right-col { width: 380px; min-width: 380px; max-width: 380px; display: flex; flex-direction: column; gap: 16px; }
        .cube-container { width: 100%; height: 380px; background: #000; border-radius: 1.5rem; border: 4px solid #334155; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        twisty-player { width: 100% !important; height: 100% !important; }
        
        /* ãƒœã‚¿ãƒ³åŸºæœ¬ */
        .mode-btn { flex: 1; padding: 10px 0; border-radius: 8px; font-size: 12px; font-weight: 900; transition: all 0.2s; border: 2px solid transparent; }
        .mode-rotate-active { background-color: #059669 !important; color: white !important; border-color: #10b981 !important; box-shadow: 0 4px 12px rgba(16,185,129,0.3); }
        .mode-paint-active { background-color: #ea580c !important; color: white !important; border-color: #fb923c !important; box-shadow: 0 4px 12px rgba(234,88,12,0.3); }
        .mode-inactive { background-color: #0f172a !important; color: #475569 !important; border-color: #1e293b !important; }

        .move-btn { @apply bg-slate-700 active:bg-indigo-600 text-white py-2 rounded text-[10px] font-mono font-bold border border-slate-600; }
        .tab-btn { @apply flex-1 py-1.5 text-[9px] font-black rounded-md transition-all border border-transparent text-slate-400; }
        .tab-btn.active { @apply bg-slate-600 text-white border-slate-500; }
        .color-dot { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #475569; cursor: pointer; }
        .color-dot.active { border-color: white; transform: scale(1.1); box-shadow: 0 0 10px rgba(255,255,255,0.4); }
        .template-btn { @apply flex-1 py-2 text-[10px] font-black rounded-lg border-2 bg-slate-800 border-slate-700 text-slate-400; }
        .template-btn.active { @apply bg-orange-600 border-orange-400 text-white shadow-lg; }
        
        @media (max-width: 850px) { .main-grid { flex-direction: column; } .right-col { width: 100%; min-width: 100%; } }
    </style>
</head>
<body class="min-h-screen bg-slate-900 text-slate-100 p-4 font-sans overflow-x-hidden">

    <div class="max-w-[1200px] mx-auto">
        <header class="mb-4 flex justify-between items-center border-b border-slate-700 pb-4">
            <div class="flex items-baseline gap-3">
                <h2 class="text-2xl font-black text-emerald-400 italic">KAZCUBE Lab</h2>
                <span class="text-[10px] font-mono text-slate-500 px-2 py-0.5 border border-slate-700 rounded bg-slate-800/50 uppercase">v5.24</span>
            </div>
            <div class="flex gap-2">
                <button onclick="setLang('ja')" class="px-2 py-1 text-[9px] font-bold rounded bg-slate-800 border border-slate-700">JP</button>
                <button onclick="setLang('en')" class="px-2 py-1 text-[9px] font-bold rounded bg-slate-800 border border-slate-700">EN</button>
            </div>
        </header>

        <div class="main-grid">
            <div class="left-col space-y-4">
                <div class="cube-container shadow-2xl">
                    <twisty-player id="main-cube" puzzle="3x3x3" background="none" control-panel="none"></twisty-player>
                </div>
                <div class="bg-slate-800/50 p-4 rounded-2xl border border-slate-700 shadow-xl space-y-3">
                    <input type="range" id="move-slider" min="0" max="0" value="0" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                    <div class="flex justify-between items-center font-mono">
                        <div class="flex flex-col"><span id="lbl-step" class="text-slate-500 text-[9px] font-bold uppercase">Step</span><span id="step-counter" class="text-emerald-500 text-xl font-bold">0</span></div>
                        <div id="move-indicator" class="text-lg font-black bg-slate-900 px-4 py-1 rounded-xl text-emerald-400 border border-slate-700 italic">---</div>
                    </div>
                </div>
            </div>

            <div class="right-col">
                <div class="flex bg-slate-950 p-1 rounded-xl border border-slate-700 gap-1 shadow-inner">
                    <button id="mode-rotate" class="mode-btn mode-rotate-active">ROTATE</button>
                    <button id="mode-paint" class="mode-btn mode-inactive">PAINT</button>
                </div>

                <div id="paint-panel" class="hidden space-y-4 p-4 bg-slate-900 rounded-xl border-2 border-orange-500/20">
                    <div class="space-y-2">
                        <label id="lbl-display" class="text-[9px] font-black text-slate-500 uppercase">Display Settings</label>
                        <div class="flex gap-2">
                            <button class="template-btn" data-type="clear" id="btn-all-gray">â¬œ ALL GRAY</button>
                            <button class="template-btn" data-type="corners" id="btn-corners">ðŸ§© CORNERS</button>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label id="lbl-target" class="text-[9px] font-black text-slate-500 uppercase">Target Color</label>
                        <div class="flex flex-wrap justify-center gap-2 p-2 bg-black/40 rounded-xl border border-slate-800">
                            <div class="color-dot" data-color="white" style="background-color: #fff;"></div>
                            <div class="color-dot" data-color="yellow" style="background-color: #facc15;"></div>
                            <div class="color-dot" data-color="red" style="background-color: #ef4444;"></div>
                            <div class="color-dot" data-color="orange" style="background-color: #f97316;"></div>
                            <div class="color-dot" data-color="blue" style="background-color: #3b82f6;"></div>
                            <div class="color-dot" data-color="green" style="background-color: #22c55e;"></div>
                        </div>
                    </div>
                </div>

                <div class="space-y-2">
                    <textarea id="command-box" class="w-full h-20 bg-black/60 text-emerald-400 p-3 rounded-xl font-mono text-xs border border-slate-700 outline-none resize-none" placeholder="Algorithm..."></textarea>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="btn-scramble" class="py-2.5 rounded-lg bg-indigo-600 font-bold text-[10px] text-white uppercase shadow-lg active:scale-95 transition-all">SCRAMBLE</button>
                        <button id="btn-reset" class="py-2.5 rounded-lg bg-slate-700 text-slate-300 border border-slate-600 font-bold text-[10px] uppercase active:scale-95 transition-all">RESET</button>
                    </div>
                </div>

                <div class="bg-slate-800/40 rounded-xl border border-slate-700 p-3">
                    <div class="flex gap-1 mb-3 bg-black/30 p-1 rounded-lg">
                        <button id="tab-basic" class="tab-btn active">BASIC</button>
                        <button id="tab-wide" class="tab-btn">WIDE</button>
                        <button id="tab-slice" class="tab-btn">SLICE/ROT</button>
                    </div>
                    <div id="move-grid" class="grid grid-cols-6 gap-1"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        const player = document.getElementById('main-cube');
        const paintPanel = document.getElementById('paint-panel');
        const slider = document.getElementById('move-slider');
        const rotateBtn = document.getElementById('mode-rotate');
        const paintBtn = document.getElementById('mode-paint');
        let moves = [];

        // æç”»æ›´æ–°ã®å¾¹åº•ï¼šã‚ãˆã¦é•·ã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’è¨­ã‘ã‚‹
        const forceUpdate = () => {
            const tempAlg = player.alg;
            player.alg = ""; 
            setTimeout(() => { player.alg = tempAlg; }, 30);
        };

        const setRotateMode = () => {
            paintPanel.style.display = 'none';
            player.experimentalStickeringMaskOrbits = ""; // ãƒžã‚¹ã‚¯å…¨è§£é™¤
            rotateBtn.className = "mode-btn mode-rotate-active";
            paintBtn.className = "mode-btn mode-inactive";
            forceUpdate();
        };

        const setPaintMode = () => {
            paintPanel.style.display = 'block';
            player.experimentalStickeringMaskOrbits = "EDGES:IIIIIIIIIIII,CORNERS:IIIIIIII,CENTERS:IIIIII";
            rotateBtn.className = "mode-btn mode-inactive";
            paintBtn.className = "mode-btn mode-paint-active";
            forceUpdate();
        };

        rotateBtn.onclick = setRotateMode;
        paintBtn.onclick = setPaintMode;

        // æ‰‹é †ã®æç”»
        const render = (step) => {
            player.alg = moves.slice(0, step).join(" ");
            slider.value = step;
            document.getElementById('step-counter').textContent = step;
            document.getElementById('move-indicator').textContent = step > 0 ? moves[step-1] : "---";
        };

        // ä»¥é™ã€ã‚¿ãƒ–ã‚„ãƒ‘ãƒ¬ãƒƒãƒˆã®ãƒ­ã‚¸ãƒƒã‚¯ã¯ç¶­æŒ
        const moveSets = {
            basic: ['U','D','L','R','F','B'],
            wide: ['u','d','l','r','f','b'],
            slice: ['M','E','S','x','y','z']
        };

        const updateMoveGrid = (type) => {
            const grid = document.getElementById('move-grid');
            grid.innerHTML = '';
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + type).classList.add('active');
            moveSets[type].forEach(f => {
                [f, f+"'", f+"2"].forEach(m => {
                    const b = document.createElement('button');
                    b.className = "move-btn"; b.textContent = m;
                    b.onclick = () => {
                        const step = parseInt(slider.value);
                        if (step < moves.length) moves = moves.slice(0, step);
                        moves.push(m);
                        slider.max = moves.length;
                        render(moves.length);
                    };
                    grid.appendChild(b);
                });
            });
        };

        document.getElementById('tab-basic').onclick = () => updateMoveGrid('basic');
        document.getElementById('tab-wide').onclick = () => updateMoveGrid('wide');
        document.getElementById('tab-slice').onclick = () => updateMoveGrid('slice');
        updateMoveGrid('basic');

        document.querySelectorAll('.template-btn').forEach(btn => {
            btn.onclick = (e) => {
                player.experimentalStickeringMaskOrbits = (e.currentTarget.dataset.type === 'clear') ? "EDGES:IIIIIIIIIIII,CORNERS:IIIIIIII,CENTERS:IIIIII" : "EDGES:IIIIIIIIIIII,CORNERS:--------,CENTERS:------";
                document.querySelectorAll('.template-btn').forEach(b => b.classList.remove('active'));
                e.currentTarget.classList.add('active');
                forceUpdate();
            };
        });

        document.querySelectorAll('.color-dot').forEach(dot => {
            dot.onclick = (e) => {
                document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
                e.currentTarget.classList.add('active');
            };
        });