<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAZCUBE Lab - Ver 5.6 Side-by-Side Fixed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>
    <style>
        twisty-player { touch-action: none; width: 100%; height: 100%; }
        /* 常に横並びを維持するためのベース */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 380px; /* 右カラムの幅を固定的に確保 */
            gap: 24px;
            align-items: start;
        }
        /* 画面が非常に狭い場合のみスクロールを許容 */
        @media (max-width: 800px) {
            .main-grid {
                grid-template-columns: 1fr 300px; /* 狭いブラウザ用 */
                gap: 12px;
            }
        }
        .move-btn { @apply bg-slate-700 active:bg-indigo-600 text-white py-1.5 rounded text-[10px] font-mono font-bold border border-slate-600 transition-all hover:border-emerald-500; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out; }
        .accordion-content.open { max-height: 800px; }
        .cube-container { position: sticky; top: 20px; }
    </style>
</head>
<body class="min-h-screen bg-slate-900 text-slate-100 p-4 lg:p-6 overflow-x-auto">
    <div class="min-w-[750px] max-w-[1400px] mx-auto">
        
        <header class="mb-6 flex justify-between items-center border-b border-slate-700 pb-4">
            <div class="flex items-baseline gap-3">
                <h2 class="text-2xl font-black text-emerald-400 italic">KAZCUBE Lab</h2>
                <span class="text-[10px] font-mono text-slate-500 px-2 py-0.5 border border-slate-700 rounded uppercase tracking-widest">v5.6 Side-Fixed</span>
            </div>
            <div id="mode-badge" class="text-[10px] font-mono bg-blue-900 text-blue-200 px-4 py-1 rounded-full border border-blue-500/30 uppercase tracking-[0.2em]">Rotate Mode</div>
        </header>

        <div class="main-grid">
            <div class="cube-container space-y-4">
                <div class="bg-black rounded-3xl aspect-square border-4 border-slate-700 overflow-hidden shadow-2xl">
                    <twisty-player id="main-cube" puzzle="3x3x3" background="none" control-panel="none"></twisty-player>
                </div>

                <div class="bg-slate-800/50 p-6 rounded-3xl border border-slate-700 shadow-xl space-y-4">
                    <div class="flex justify-between items-center px-1">
                        <span class="text-[11px] font-black text-slate-500 uppercase tracking-widest">Playback Control</span>
                        <div id="move-indicator" class="text-lg font-mono font-black bg-slate-900 px-6 py-1 rounded-xl text-emerald-400 border border-slate-700 shadow-inner italic">---</div>
                    </div>
                    <input type="range" id="move-slider" min="0" max="0" value="0" step="1" class="w-full h-2.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500">
                    <div class="flex justify-between text-[11px] font-mono font-bold">
                        <div class="flex flex-col">
                            <span class="text-slate-500">STEP</span>
                            <span id="step-counter" class="text-emerald-500 text-2xl">0</span>
                        </div>
                        <div class="flex flex-col items-end">
                            <span class="text-slate-500">TOTAL</span>
                            <span id="total-counter" class="text-slate-400 text-2xl">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-6 pb-20">
                <div class="flex bg-slate-950 p-1.5 rounded-2xl border border-slate-700 shadow-lg">
                    <button id="mode-rotate" class="flex-1 py-3 rounded-xl text-xs font-black bg-emerald-600 text-white">ROTATE</button>
                    <button id="mode-paint" class="flex-1 py-3 rounded-xl text-xs font-black text-slate-500">PAINT</button>
                </div>

                <div id="paint-panel" class="hidden space-y-4 p-4 bg-slate-900 rounded-2xl border-2 border-orange-500/20">
                    <div class="flex gap-2">
                        <button class="template-btn flex-1 py-2 text-[10px] font-bold bg-slate-800 border border-slate-700 rounded-lg" data-type="clear">ALL CLEAR</button>
                        <button class="template-btn flex-1 py-2 text-[10px] font-bold bg-slate-800 border border-slate-700 rounded-lg" data-type="corners">CORNERS</button>
                    </div>
                    <div class="flex flex-wrap justify-center gap-2 p-2 bg-black/30 rounded-xl">
                        <div class="color-dot active bg-white w-6 h-6 rounded-full border-2 border-slate-700" data-color="white"></div>
                        <div class="color-dot bg-yellow-400 w-6 h-6 rounded-full border-2 border-slate-700" data-color="yellow"></div>
                        <div class="color-dot bg-red-500 w-6 h-6 rounded-full border-2 border-slate-700" data-color="red"></div>
                        <div class="color-dot bg-orange-500 w-6 h-6 rounded-full border-2 border-slate-700" data-color="orange"></div>
                        <div class="color-dot bg-blue-500 w-6 h-6 rounded-full border-2 border-slate-700" data-color="blue"></div>
                        <div class="color-dot bg-green-500 w-6 h-6 rounded-full border-2 border-slate-700" data-color="green"></div>
                        <div class="color-dot bg-slate-500 w-6 h-6 rounded-full border-2 border-slate-700" data-color="gray"></div>
                    </div>
                </div>

                <div class="space-y-3">
                    <textarea id="command-box" class="w-full h-28 bg-black/60 text-emerald-400 p-4 rounded-2xl font-mono text-xs border border-slate-700 outline-none focus:border-indigo-500 shadow-inner resize-none transition-all" placeholder="Enter sequence..."></textarea>
                    <div class="grid grid-cols-2 gap-3">
                        <button id="btn-scramble" class="py-3 bg-indigo-600 hover:bg-indigo-500 rounded-xl font-bold text-xs uppercase tracking-widest active:scale-95 transition-all">Scramble</button>
                        <button id="btn-reset" class="py-3 bg-slate-700 hover:bg-red-900 text-slate-300 rounded-xl font-bold text-xs uppercase tracking-widest border border-slate-600">Reset</button>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="border border-slate-700 rounded-2xl overflow-hidden bg-slate-900/40">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-[10px] font-black uppercase tracking-widest hover:bg-slate-800" data-target="basic-moves">
                            <span>Basic (U R L D F B)</span>
                            <span class="icon">▼</span>
                        </button>
                        <div id="basic-moves" class="accordion-content open">
                            <div class="grid grid-cols-4 gap-1.5 p-4" id="grid-basic"></div>
                        </div>
                    </div>
                    <div class="border border-slate-700 rounded-2xl overflow-hidden bg-slate-900/40">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-[10px] font-black uppercase tracking-widest hover:bg-slate-800" data-target="wide-moves">
                            <span>Wide & Middle</span>
                            <span class="icon">▼</span>
                        </button>
                        <div id="wide-moves" class="accordion-content">
                            <div class="grid grid-cols-4 gap-1.5 p-4" id="grid-wide"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        const player = document.getElementById('main-cube');
        const cmdBox = document.getElementById('command-box');
        const slider = document.getElementById('move-slider');
        const stepCounter = document.getElementById('step-counter');
        const totalCounter = document.getElementById('total-counter');
        const moveIndicator = document.getElementById('move-indicator');
        
        let moves = [];
        let currentMode = 'rotate';

        const createBtns = (targetId, faces) => {
            const grid = document.getElementById(targetId);
            faces.forEach(f => {
                [f, f+"'", f+"2"].forEach(m => {
                    const btn = document.createElement('button');
                    btn.className = "move-btn";
                    btn.textContent = m;
                    btn.onclick = () => handleMove(m);
                    grid.appendChild(btn);
                });
            });
        };

        createBtns('grid-basic', ['U','D','L','R','F','B']);
        createBtns('grid-wide', ['u','d','l','r','f','b','M','E','S','x','y','z']);

        document.querySelectorAll('.accordion-toggle').forEach(btn => {
            btn.onclick = () => {
                const target = document.getElementById(btn.dataset.target);
                const isOpen = target.classList.contains('open');
                target.classList.toggle('open', !isOpen);
                btn.querySelector('.icon').textContent = isOpen ? '▼' : '▲';
            };
        });

        const render = (step) => {
            player.alg = moves.slice(0, step).join(" ");
            slider.value = step;
            stepCounter.textContent = step;
            totalCounter.textContent = moves.length;
            moveIndicator.textContent = step > 0 ? moves[step-1] : "---";
            if (currentMode === 'rotate') cmdBox.value = moves.join(" ");
        };

        const handleMove = (m) => {
            const step = parseInt(slider.value);
            if (step < moves.length) moves = moves.slice(0, step);
            moves.push(m);
            slider.max = moves.length;
            render(moves.length);
        };

        slider.oninput = () => render(parseInt(slider.value));

        const setMode = (mode) => {
            currentMode = mode;
            const isPaint = mode === 'paint';
            document.getElementById('paint-panel').classList.toggle('hidden', !isPaint);
            document.getElementById('mode-rotate').classList.toggle('bg-emerald-600', !isPaint);
            document.getElementById('mode-paint').classList.toggle('bg-orange-600', isPaint);
            if (isPaint) player.experimentalStickeringMaskOrbits = "EDGES:------------,CORNERS:--------,CENTERS:------";
        };

        document.getElementById('mode-rotate').onclick = () => setMode('rotate');
        document.getElementById('mode-paint').onclick = () => setMode('paint');

        document.getElementById('btn-reset').onclick = () => {
            moves = []; slider.max = 0; cmdBox.value = ""; player.alg = "";
            player.experimentalStickeringMaskOrbits = "";
            render(0); setMode('rotate');
        };

        document.getElementById('btn-scramble').onclick = () => {
            if(cmdBox.value) moves = cmdBox.value.split(/\s+/).filter(x => x.length > 0);
            else {
                const f = ['U','D','L','R','F','B'];
                moves = Array.from({length:20}, () => f[Math.floor(Math.random()*6)] + (Math.random() > 0.6 ? "2" : (Math.random() > 0.3 ? "'" : "")));
            }
            slider.max = moves.length;
            render(moves.length);
        };
    </script>
</body>
</html>