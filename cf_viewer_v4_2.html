<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>CF Viewer v4.2 (cubing.js版・Solve付き)</title>

<!-- cubing.js: twisty-player -->
<script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>

<style>
  body { font-family: system-ui; background:#111; color:#f5f5f5; padding:16px; }
  h1, h2 { text-align:center; margin:4px 0; }
  .layout { display:flex; gap:20px; justify-content:center; flex-wrap:wrap; }
  twisty-player { width:300px; height:300px; background:none; }
  .panel { background:#1e1e1e; padding:12px; border-radius:12px; box-shadow:0 4px 16px #0006; }
  button { margin:4px; padding:6px 10px; background:#333; color:#fff; border:1px solid #555; border-radius:6px; cursor:pointer; }
  button:hover { background:#444; }
  textarea { width:100%; min-height:50px; background:#111; color:#fff; border-radius:8px; border:1px solid #333; padding:6px; }
</style>

</head>
<body>

<h1>CF Viewer v4.2</h1>

<div class="layout">
  <div class="panel">
    <h2>3×3 Viewer</h2>
    <twisty-player id="cube3" puzzle="3x3x3" background="none"></twisty-player>

    <button id="btnRandomScramble">Random Scramble</button>
    <button id="btnApplyScramble">Apply Scramble</button>
    <button id="btnSolve">Solve</button>
    <button id="btnResetAll">Reset</button>

    <textarea id="scrambleInput" placeholder="スクランブル手順が表示されます"></textarea>

    <h3>Move Buttons</h3>
    <div>
      <button class="mv" data-m="U">U</button>
      <button class="mv" data-m="U'">U'</button>
      <button class="mv" data-m="U2">U2</button>
      <button class="mv" data-m="R">R</button>
      <button class="mv" data-m="R'">R'</button>
      <button class="mv" data-m="R2">R2</button>
      <button class="mv" data-m="L">L</button>
      <button class="mv" data-m="L'">L'</button>
      <button class="mv" data-m="L2">L2</button><br>
      <button class="mv" data-m="F">F</button>
      <button class="mv" data-m="F'">F'</button>
      <button class="mv" data-m="F2">F2</button>
      <button class="mv" data-m="B">B</button>
      <button class="mv" data-m="B'">B'</button>
      <button class="mv" data-m="B2">B2</button>
      <button class="mv" data-m="D">D</button>
      <button class="mv" data-m="D'">D'</button>
      <button class="mv" data-m="D2">D2</button>
    </div>

    <h3>Apply 手順入力</h3>
    <textarea id="algInput" placeholder="例: R U R' U'"></textarea>
    <button id="btnApplyAlg">Apply</button>
    <button id="btnClearAlg">Clear</button>
  </div>

  <div class="panel">
    <h2>Corner-only Viewer</h2>
    <twisty-player id="cube2" puzzle="3x3x3" background="none"></twisty-player>

    <button id="btnScrambleCorner">Apply Scramble to Corner</button>
    <button id="btnResetCorner">Reset Corner</button>

    <textarea id="algInputCorner" placeholder="Corner 手順"></textarea>
    <button id="btnApplyAlgCorner">Apply Corner</button>
    <button id="btnClearAlgCorner">Clear Corner</button>
  </div>
</div>

<script type="module">

  const cube3 = document.getElementById("cube3");
  const cube2 = document.getElementById("cube2");

  let alg3 = "";
  let alg2 = "";

  const MOVES = ["U","D","L","R","F","B"];
  const SUFF  = ["", "'", "2"];

  function generateScramble(n){
    let s = [], last="";
    for(let i=0;i<n;i++){
      let m;
      do{ m = MOVES[Math.floor(Math.random()*MOVES.length)]; }
      while(m===last);
      last = m;
      let suf = SUFF[Math.floor(Math.random()*SUFF.length)];
      s.push(m+suf);
    }
    return s.join(" ");
  }

  function applyToCube(cube, alg){
    cube.alg = alg;
  }

  // Scramble
  document.getElementById("btnRandomScramble").onclick = ()=>{
    const s = generateScramble(20);
    document.getElementById("scrambleInput").value = s;
    alg3 = s;
    alg2 = s;
    applyToCube(cube3, alg3);
    applyToCube(cube2, alg2);
  };

  document.getElementById("btnApplyScramble").onclick = ()=>{
    const s = document.getElementById("scrambleInput").value.trim();
    alg3 = s; alg2 = s;
    applyToCube(cube3, alg3);
    applyToCube(cube2, alg2);
  };

  // Solve (完成状態へアニメーション)
  document.getElementById("btnSolve").onclick = ()=>{
    cube3.timeline.set(0);
    cube2.timeline.set(0);
    cube3.play();
    cube2.play();
  };

  document.getElementById("btnResetAll").onclick = ()=>{
    alg3=""; alg2="";
    applyToCube(cube3, "");
    applyToCube(cube2, "");
    document.getElementById("algInput").value="";
  };

  // Move buttons
  document.querySelectorAll(".mv").forEach(btn=>{
    btn.onclick = ()=>{
      const m = btn.dataset.m;
      alg3 = (alg3+" "+m).trim();
      applyToCube(cube3, alg3);
      alg2 = alg3;
      applyToCube(cube2, alg2);
    };
  });

  // Apply 手順
  document.getElementById("btnApplyAlg").onclick = ()=>{
    alg3 = document.getElementById("algInput").value.trim();
    applyToCube(cube3, alg3);
  };
  document.getElementById("btnClearAlg").onclick = ()=>{
    document.getElementById("algInput").value="";
  };

  // Corner
  document.getElementById("btnScrambleCorner").onclick = ()=>{
    const s = document.getElementById("scrambleInput").value.trim();
    alg2 = s;
    applyToCube(cube2, alg2);
  };
  document.getElementById("btnResetCorner").onclick = ()=>{
    alg2="";
    applyToCube(cube2, "");
  };
  document.getElementById("btnApplyAlgCorner").onclick = ()=>{
    alg2 = document.getElementById("algInputCorner").value.trim();
    applyToCube(cube2, alg2);
  };
  document.getElementById("btnClearAlgCorner").onclick = ()=>{
    document.getElementById("algInputCorner").value="";
  };

</script>

</body>
</html>
